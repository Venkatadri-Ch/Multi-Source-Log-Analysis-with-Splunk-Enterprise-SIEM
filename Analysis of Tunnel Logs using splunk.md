# Analyzing tunnel Logs Using Splunk
### Introduction

The tunnel log traffic generated by Zeek IDS (formerly known as Bro IDS) contains detailed information about various tunneling protocols. Analyzing this tunnel log data using Splunk SIEM enables security professionals to effectively monitor tunneling activities, detect anomalies, and identify potential security threats within the network.

### Prerequisites

- Splunk is installed and configured.
- [tunnel log dataset](https://www.secrepo.com/maccdc2012/tunnel.log.gz)

Note: The steps to upload the sample tunnel log dataset to Splunk are the same as those used for the  DNS log analysis. I have given the source type name as "tunnel".

# Analyzing tunnel Logs with Splunk

### 1.Search for tunnel Events

```
index=* OR index="log_analysis" sourcetype="tunnel"
```

- index=* - Searches all indexes in Splunk (this can be slow and noisy).
- OR index="log_analysis" - Also includes your specific index called log_analysis.
- sourcetype="tunnel" - It gives results to events with the sourcetype “tunnel” .

<img width="931" height="436" alt="total events 1" src="https://github.com/user-attachments/assets/04a3396d-5380-48bf-aa10-dbbd1bdffdc3" />

I identified a total of 280 tunnel events and I didn’t find any interesting fields, so extracted them manually.

### 2.Extracted Fields

Using the same field extraction steps as in the previous DNS log analysis, I extracted the following fields: src_port, dst_port, src_ip, dst_ip, client_hostname, reply_code, reply_text, recipient_ips, ts.
- src_ip: Represents the source IP address — the device or host that initiates the tunnel connection.
- dst_ip: Indicates the destination IP address of the endpoint where the tunnel connection is established.
- src_port: Refers to the source port number used by the originating system to start the communication.
- dst_port: Denotes the destination port number on the remote endpoint that receives the tunneled traffic.
- ts: Captures the timestamp of when the tunneling event occurred, allowing chronological analysis of tunnel activity.
- event_type: Specifies the type of event recorded in the log, such as the (close,discover).
- tunnel_type: Identifies the protocol or tunneling (TEREDO).

<img width="927" height="370" alt="extracted" src="https://github.com/user-attachments/assets/796ae5aa-5654-4763-9ba5-062ecc979bc3" />

### 3. Analysis of Tunnel Events by Protocol and Event Type

```
index=log_analysis sourcetype=tunnel
| stats count by tunnel_type, event_type
| sort - count
```
- | stats count by tunnel_type, event_type
  The stats command aggregates events and counts how many times each combination of tunnel_type and event_type occurs.

- tunnel_type - indicates the tunneling protocol (e.g., GRE, Teredo, IPv6, etc.)

- event_type - specifies the kind of event (e.g., start, end, update, etc.)
  This shows how often each tunneling protocol is observed and what kinds of events are associated with it.

- | sort - count
  This sorts the results in descending order of event count, meaning the most active tunnel types appear top of the results

<img width="934" height="380" alt="2" src="https://github.com/user-attachments/assets/8288e5fc-f00a-40ac-ad7f-3056be9c4251" />

The analysis of tunnel logs revealed consistent activity for the Teredo tunneling protocol, with equal counts of DISCOVER and CLOSE events. This indicates that Teredo tunnels were being properly initiated and terminated without signs of abnormal persistence or misuse.

- Teredo:Teredo is an IPv6 transition tunneling protocol developed by Microsoft.
         Its main purpose is to enable IPv6 connectivity over IPv4 networks, especially in situations where a device is behind a Network Address Translation (NAT) device             which normally blocks direct IPv6 traffic.

In simple terms: Teredo allows IPv6 packets to be encapsulated inside IPv4 UDP packets, so that devices that don’t have native IPv6 support can still communicate using IPv6 over the existing IPv4 Internet.

- Tunnel1::DISCOVER
  This event indicates that a host is attempting to discover or establish a Teredo tunnel.

- Tunnel1::CLOSE
  This event occurs when a Teredo tunnel session is terminated.

### 4. Time-Based Analysis of Teredo Tunnel Activity

```
index=log_analysis sourcetype=tunnel tunnel_type="tunnel::TEREDO"
| timechart span=1h count by event_type
```
- tunnel_type="tunnel::TEREDO"
Filters the results to only include logs related to the Teredo tunneling protocol.

- | timechart span=1h count by event_type
The timechart command visualizes data over time.

- span=1h groups data into 1-hour intervals.

- count by event_type counts the number of events for each event_type (e.g., DISCOVER, CLOSE) within each hour.

<img width="933" height="427" alt="3" src="https://github.com/user-attachments/assets/d77fd271-c879-40bb-806b-8986927ec6f4" />

The analysis revealed a brief period of Teredo tunneling activity at 14:00 on 2025-10-28, with 140 discovery and 140 closure events recorded. This indicates that each tunnel was successfully initiated and terminated, showing no abnormal or persistent tunnel behavior. No additional Teredo activity was observed during the subsequent hours, suggesting a short and controlled tunneling session.

- there is only one tunnel protocol(TEREDO) in the tunnel logs with 280 events.

<img width="722" height="315" alt="single protocol 5" src="https://github.com/user-attachments/assets/23e6c620-4733-4400-b5ef-858371eb6ff2" />

### 5. Analyzing Top 10 Source IPs Initiating Teredo Tunnel Connections
```
index=log_analysis sourcetype=tunnel tunnel_type="Tunnel::TEREDO"
| stats count by src_ip
| sort -count
| head 10
```
This SPL query searches the tunnel logs in the log_analysis index for events related to the Teredo tunneling protocol.
It then uses the stats command to count the number of Teredo tunnel events generated by each source IP address (src_ip), sorts them in descending order of frequency, and displays the top 10 most active source IPs.

<img width="926" height="364" alt="Top Source IPs Initiating TEREDO Tunnels 6" src="https://github.com/user-attachments/assets/86178611-ab7e-4f7c-aae5-fa8221251685" />

The top three source IPs initiating Teredo tunnels were 192.168.202.110, 192.168.202.140, and 192.168.200.138, generating 134, 118, and 98 events respectively. The activity appears balanced across these hosts, indicating normal usage of Teredo tunnels with no single system exhibiting unusually high or suspicious activity.

### 6. Analyzing Top 10 Destination IPs Receiving Teredo Tunnel Connections
```
index=log_analysis sourcetype=tunnel tunnel_type="Tunnel::TEREDO"
| stats count by dst_ip
| sort -count
| head 10
```
- This query searches the tunnel logs in the log_analysis index for Teredo tunnel events. It then:
- Uses stats count by dst_ip to count the number of Teredo tunnel events received by each destination IP.
- Sorts the results in descending order of count (sort -count).
- Displays the top 10 most contacted destination IPs using the Teredo protocol (head 10).

<img width="936" height="438" alt="Top Destination IPs 7" src="https://github.com/user-attachments/assets/00afcabf-d446-465f-adcc-abb9dd2c9aa7" />

The analysis shows that Teredo tunnel events were evenly distributed across the top 10 destination IPs, with each host receiving 6 events. This uniform distribution indicates that Teredo tunnels were not concentrated on any single endpoint, suggesting normal, controlled usage rather than targeted or suspicious activity. Overall, the communication pattern appears balanced across multiple destination hosts.

### 7. Anomaly Detection in Hourly Teredo Tunnel Events
```
index=log_analysis sourcetype=tunnel tunnel_type="Tunnel::TEREDO"
| timechart span=1h count by event_type
| anomalydetection
```
- index=log_analysis sourcetype=tunnel tunnel_type="Tunnel::TEREDO" – searches the tunnel logs for Teredo events.

- | timechart span=1h count by event_type – creates an hourly chart of event counts by type (DISCOVER, CLOSE) to show trends over time.

- | anomalydetection – detects unusual spikes or drops in events, highlighting potential anomalies for security analysis.

<img width="936" height="287" alt="anamoly detection 8" src="https://github.com/user-attachments/assets/e15613d6-5704-45d9-955b-a2dda484eea2" />

At 14:30 on 2025-10-29, Teredo tunnel events spiked to 140 for both DISCOVER and CLOSE, triggering an anomaly alert. The spike was primarily linked to tunnel closures, but all tunnels were properly terminated, indicating controlled but unusual activity.

# Conclusion 

In this project, we analyzed Teredo tunnel activity using Zeek IDS logs in Splunk. We found that tunnels were generally short-lived, properly started and closed, and spread across several source and destination IPs. Looking at the data over time, we saw occasional spikes, which anomaly detection flagged as unusual but not harmful. Tracking the source and destination IPs helped pinpoint the most active hosts and endpoints.




