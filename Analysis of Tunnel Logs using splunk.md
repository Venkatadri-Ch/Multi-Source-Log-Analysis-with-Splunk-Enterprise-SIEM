# Analyzing tunnel Logs Using Splunk
### Introduction

The tunnel log traffic generated by Zeek IDS (formerly known as Bro IDS) contains detailed information about various tunneling protocols. Analyzing this tunnel log data using Splunk SIEM enables security professionals to effectively monitor tunneling activities, detect anomalies, and identify potential security threats within the network.

### Prerequisites

- Splunk is installed and configured.
- [tunnel log dataset](https://www.secrepo.com/maccdc2012/tunnel.log.gz)

Note: The steps to upload the sample tunnel log dataset to Splunk are the same as those used for the  DNS log analysis. I have given the source type name as "tunnel".

# Analyzing tunnel Logs with Splunk

### 1.Search for tunnel Events

```
index=* OR index="log_analysis" sourcetype="tunnel"
```

- index=* - Searches all indexes in Splunk (this can be slow and noisy).
- OR index="log_analysis" - Also includes your specific index called log_analysis.
- sourcetype="tunnel" - It gives results to events with the sourcetype “tunnel” .

<img width="931" height="436" alt="total events 1" src="https://github.com/user-attachments/assets/04a3396d-5380-48bf-aa10-dbbd1bdffdc3" />

I identified a total of 280 tunnel events and I didn’t find any interesting fields, so extracted them manually.

### 2.Extracted Fields

Using the same field extraction steps as in the previous DNS log analysis, I extracted the following fields: src_port, dst_port, src_ip, dst_ip, client_hostname, reply_code, reply_text, recipient_ips, ts.
- src_ip: Represents the source IP address — the device or host that initiates the tunnel connection.
- dst_ip: Indicates the destination IP address of the endpoint where the tunnel connection is established.
- src_port: Refers to the source port number used by the originating system to start the communication.
- dst_port: Denotes the destination port number on the remote endpoint that receives the tunneled traffic.
- ts: Captures the timestamp of when the tunneling event occurred, allowing chronological analysis of tunnel activity.
- event_type: Specifies the type of event recorded in the log, such as the (close,discover).
- tunnel_type: Identifies the protocol or tunneling (TEREDO).

<img width="927" height="370" alt="extracted" src="https://github.com/user-attachments/assets/796ae5aa-5654-4763-9ba5-062ecc979bc3" />

### 3. Analysis of Tunnel Events by Protocol and Event Type

```
index=log_analysis sourcetype=tunnel
| stats count by tunnel_type, event_type
| sort - count
```
- | stats count by tunnel_type, event_type
  The stats command aggregates events and counts how many times each combination of tunnel_type and event_type occurs.

- tunnel_type - indicates the tunneling protocol (e.g., GRE, Teredo, IPv6, etc.)

- event_type - specifies the kind of event (e.g., start, end, update, etc.)
  This shows how often each tunneling protocol is observed and what kinds of events are associated with it.

- | sort - count
  This sorts the results in descending order of event count, meaning the most active tunnel types appear top of the results

<img width="934" height="380" alt="2" src="https://github.com/user-attachments/assets/8288e5fc-f00a-40ac-ad7f-3056be9c4251" />

The analysis of tunnel logs revealed consistent activity for the Teredo tunneling protocol, with equal counts of DISCOVER and CLOSE events. This indicates that Teredo tunnels were being properly initiated and terminated without signs of abnormal persistence or misuse.

- Teredo:Teredo is an IPv6 transition tunneling protocol developed by Microsoft.
         Its main purpose is to enable IPv6 connectivity over IPv4 networks, especially in situations where a device is behind a Network Address Translation (NAT) device             which normally blocks direct IPv6 traffic.

In simple terms: Teredo allows IPv6 packets to be encapsulated inside IPv4 UDP packets, so that devices that don’t have native IPv6 support can still communicate using IPv6 over the existing IPv4 Internet.

- Tunnel1::DISCOVER
  This event indicates that a host is attempting to discover or establish a Teredo tunnel.

- Tunnel1::CLOSE
  This event occurs when a Teredo tunnel session is terminated.

### 4. 



